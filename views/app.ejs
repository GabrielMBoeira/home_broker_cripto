<!DOCTYPE html>
<html lang="pt-BR">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <!-- ChartJS CDN -->
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

   <!-- Box Icons -->
   <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

   <!-- ChartJS CDN -->
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

   <!-- Bootstrap CSS -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

   <link rel="stylesheet" href="css/app.css">

   <title>TraderSystem</title>
</head>

<body>

   <main class="main">
      <aside class="sidebar">
         <div class="logoContent">
            <div class="logo d-flex justify-content-center">
               <i class="bx bx-line-chart fs-1"></i>
            </div>
            <i class="bx bx-menu" id="btn"></i>
         </div>
         <ul class="nav_list">
            <li>
               <i class='bx bx-search'></i>
               <input type="search" name="search" placeholder="Procurar...">
               <span class="toolipe">Procurar</span>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-grid-alt'></i>
                  <span class="links_name">Dashboard</span>
                  <span class="toolipe">Dashboard</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-user'></i>
                  <span class="links_name">Usuário</span>
                  <span class="toolipe">Usuário</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-cog'></i>
                  <span class="links_name">Configurações</span>
                  <span class="toolipe">Configurações</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-folder-open'></i>
                  <span class="links_name">Arquivos</span>
                  <span class="toolipe">Arquivos</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-chat'></i>
                  <span class="links_name">Mensagens</span>
                  <span class="toolipe">Mensagens</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-bar-chart'></i>
                  <span class="links_name">Relatórios</span>
                  <span class="toolipe">Relatórios</span>
               </a>
            </li>
            <li>
               <a href="#">
                  <i class='bx bx-bitcoin'></i>
                  <span class="links_name">Mercado</span>
                  <span class="toolipe">Mercado</span>
               </a>
            </li>
         </ul>

      </aside>
      <div class="content-main">
         <div style="margin-top: 30px; width: 100%;">
            <div class="container-fluid">
               <div class="title-main font-size:1.5rem;">
                  Home Broker
               </div>
               <div class="row">
                  <div class="col-lg-5 box-item">
                     <div class="box-item-content-1">
                        <div class="graph">
                           <canvas id="myChart" class="myChart"></canvas>
                        </div>
                     </div>
                     <div class="buttons-graph">
                        <div>Querem comprar por <span id="buy"></span></div>
                        <div>Querem vender por <span id="sell"></span></div>
                        <button class="btn btn-sm btn-success btn-graph" onclick="buy()">Comprar</button>
                        <button class="btn btn-sm btn-danger btn-graph" onclick="sell()">Vender</button>
                     </div>
                  </div>
                  <div class="col-lg-5 box-item">
                     <div class="box-item-content-2">
                        <div>Carteira</div>
                        <div class="card">
                           <div class="card-body table-responsive p-0">
                              <table class="table table-striped table-valign-middle">
                                 <thead>
                                    <tr>
                                       <th>Moeda</th>
                                       <th>Valor Free</th>
                                       <th>Valor Total</th>
                                       <th>Resultado</th>
                                    </tr>
                                 </thead>
                                 <tbody id="tbody">
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-lg-5 box-item">
                     <div class="box-item-content-3">
                        <div class="card">
                           <div class="card-body table-responsive p-0">
                              <table class="table table-striped table-valign-middle">
                                 <thead>
                                    <tr>
                                       <th>Product</th>
                                       <th>Price</th>
                                       <th>Sales</th>
                                       <th>More</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr>
                                       <td>
                                          Some Product
                                       </td>
                                       <td>$13 USD</td>
                                       <td>
                                          <small class="text-success mr-1">
                                             <i class="fas fa-arrow-up"></i>
                                             12%
                                          </small>
                                          12,000 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Another Product
                                       </td>
                                       <td>$29 USD</td>
                                       <td>
                                          <small class="text-warning mr-1">
                                             <i class="fas fa-arrow-down"></i>
                                             0.5%
                                          </small>
                                          123,234 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Amazing Product
                                       </td>
                                       <td>$1,230 USD</td>
                                       <td>
                                          <small class="text-danger mr-1">
                                             <i class="fas fa-arrow-down"></i>
                                             3%
                                          </small>
                                          198 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Perfect Item
                                          <span class="badge bg-danger">NEW</span>
                                       </td>
                                       <td>$199 USD</td>
                                       <td>
                                          <small class="text-success mr-1">
                                             <i class="fas fa-arrow-up"></i>
                                             63%
                                          </small>
                                          87 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-lg-5 box-item">
                     <div class="box-item-content-4">
                        <div class="card">
                           <div class="card-body table-responsive p-0">
                              <table class="table table-striped table-valign-middle">
                                 <thead>
                                    <tr>
                                       <th>Product</th>
                                       <th>Price</th>
                                       <th>Sales</th>
                                       <th>More</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr>
                                       <td>
                                          Some Product
                                       </td>
                                       <td>$13 USD</td>
                                       <td>
                                          <small class="text-success mr-1">
                                             <i class="fas fa-arrow-up"></i>
                                             12%
                                          </small>
                                          12,000 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Another Product
                                       </td>
                                       <td>$29 USD</td>
                                       <td>
                                          <small class="text-warning mr-1">
                                             <i class="fas fa-arrow-down"></i>
                                             0.5%
                                          </small>
                                          123,234 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Amazing Product
                                       </td>
                                       <td>$1,230 USD</td>
                                       <td>
                                          <small class="text-danger mr-1">
                                             <i class="fas fa-arrow-down"></i>
                                             3%
                                          </small>
                                          198 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                    <tr>
                                       <td>
                                          Perfect Item
                                          <span class="badge bg-danger">NEW</span>
                                       </td>
                                       <td>$199 USD</td>
                                       <td>
                                          <small class="text-success mr-1">
                                             <i class="fas fa-arrow-up"></i>
                                             63%
                                          </small>
                                          87 Sold
                                       </td>
                                       <td>
                                          <a href="#" class="text-muted">
                                             <i class="fas fa-search"></i>
                                          </a>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

   </main>

   <footer class="footer">
      <span class="content-footer">Desenvolvido por Gabriel M. Boeira</span>
   </footer>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>


   <script>

      const btn = document.querySelector('#btn');
      const bxSearch = document.querySelector('.bx-search');
      const sidebar = document.querySelector('.sidebar');

      btn.addEventListener('click', () => {
         sidebar.classList.toggle('active');
      });

      bxSearch.addEventListener('click', () => {
         sidebar.classList.toggle('active');
      });

      function buy() {

         if (confirm("Efetuar compra?") == true) {

            const options = {
               method: 'GET',
               mode: 'cors',
               headers: {
                  "Content-type": "application/x-www-form-urlencoded; charset=UTF-8"
               }
            }

            fetch("http://localhost:3000/buy", options)
               .then(resp => resp.json().then(data => console.log(data)))
               .catch(e => console.log(e.message))
         } 
      }

      function sell() {
         if (confirm("Efetuar venda?") == true) {

            const options = {
               method: 'GET',
               mode: 'cors',
               headers: {
                  "Content-type": "application/x-www-form-urlencoded; charset=UTF-8"
               }
            }
   
            fetch("http://localhost:3000/sell", options)
               .then(resp => resp.json().then(data => console.log(data)))
               .catch(e => console.log(e.message))
         }
      }

      const showData = (result) => {
         let tbody = document.getElementById('tbody');
         let buy = document.getElementById('buy');
         let sell = document.getElementById('sell');

         buy.innerHTML = parseFloat(result.buy).toFixed(2);
         sell.innerHTML = parseFloat(result.sell).toFixed(2);

         result.coins.forEach(element => {
            let html = "<tr>";
            html += "<td>" + element.asset + "</td>";
            html += "<td>" + parseFloat(element.free).toFixed(2) + "</td>";
            html += "<td>" + parseFloat(element.locked).toFixed(2) + "</td>";
            html += "<td> - </td>";
            html += "</tr>";

            tbody.insertAdjacentHTML("afterend", html);
         });
      }

      const options = {
         method: 'GET',
         mode: 'cors',
         headers: {
            "Content-type": "application/x-www-form-urlencoded; charset=UTF-8"
         }
      }

      fetch("http://localhost:3000/data", options)
         .then(resp => resp.json().then(data => showData(data)))
         .catch(e => console.log(e.message))

      //ChartJS
      const labels = [
         '1',
         '2',
         '3',
         '4',
         '5',
         '6',
         '7',
         '8',
         '9',
         '10',
         '11',
         '12',
         '13',
         '14',
         '15',
         '16',
         '17',
         '18',
         '19',
         '20',
         '21',
         '22',
         '23',
         '24',
         '25',
         '26',
         '27',
         '28',
         '29',
         '30',
         '31',
         '32',
         '33',
         '34',
         '35',
         '36',
         '37',
         '38',
         '39',
         '40',
         '41',
         '42',
         '43',
         '44',
         '45',
         '46',
         '47',
         '48',
         '49',
         '50'
      ];

      const data = {
         labels: labels,
         datasets: [{
            label: 'Cotações Mercado',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: []
            // data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            //    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1],
            // fill: false,
            // borderColor: 'rgb(0, 0, 0)',
            // tension: 0.1
         }]
      };

      const config = {
         type: 'line',
         data: data,
         options: {
            animation: false,
            // elements: {
            //     point: {
            //         radius: 0 // default to disabled in all datasets
            //     }
            // },
         }
      };

      const myChart = new Chart(
         document.getElementById('myChart'),
         config
      );

      // function randomNumber(min, max) {
      //    min = Math.ceil(min);
      //    max = Math.floor(max);
      //    return Math.floor(Math.random() * (max - min + 1)) + min;
      // }

      const updateData = function () {
         let valSell = document.getElementById('sell').innerText

         //Quantidades de parâmetros no gráfico (50)
         for (let i = 0; i < 50; i++) {
            myChart.data.datasets[0].data[i] = myChart.data.datasets[0].data[i + 1]

            if (i === 49) {
               myChart.data.datasets[0].data[i] = parseFloat(valSell).toFixed(2);
            }
         }
      };

      setInterval(() => {
         updateData();
         myChart.update();
      }, 2000)
   </script>

</body>

</html>